# Залогируй это (vporoshok.me)

## Разработчик

- отладка разрабатываемого функционала;
- разбор некорректного поведения системы в прошлом;
- разбор некорректного поведения системы в настоящем;
- определение внешних проблем;

## Эксплуатация

При этом задачи у службы эксплуатации, которые решаются, в том числе с помощью логов, следующие:

- мониторинг здоровья сервиса;
- мониторинг связанности среды;
- разбор ошибок при падении или отказе стартовать сервиса;

## Служба технической поддержки

Задачи СТП при работе с логами следующие:

- нахождение запроса в прошлом (ориентируясь на время, пользователя или другие ограничения);
- восстановление контекста конкретного запроса;
- нахождение сервиса источника ошибки;
- возможность повторить запрос;

## Архитектор

Высокоуровневый обзор текущего перфоманс системы нужно получать с использованием метрик, но часто возникает
необходимость составить карту конкретного запроса: какие операции выполнялись в каком порядке и сколько времени они
заняли:

- мониторинг различных участков кода на частоту и время обращения;
- разбор отдельных запросов с построением карты взаимодействий;

## Автоматические системы

- формирование метрик;
- события для сервисов оповещения;

## Способы работы с логами

- Активное / пассивное.
- Исторические данные / воспроизведение инцидента.
- Статистика / конкретный запрос.
- Поиск аномалий / проверка гипотез.

## Инструменты работы с логами

- Текстовые процессоры (grep, cut, head, tail, wc, jq и в особо тяжёлых случаях sed и awk);
- Graylog;
- Kibana;
- Loki;
- ClickHouse;

## Форматы

- человекочитаемый;
- syslog;
- JSON;

## Структура записи

- Временная метка;
- Система / подсистема / имя логера;

## Уровень

- ERROR
  Самый высокий уровень логирования из рассматриваемых.
  Этот уровень должен срабатывать редко, только в тех случаях, когда сервис или окружение работает некорректно и
  возникающая ошибка не обработана логикой сервиса.
  Например, если сервис обращается к внешнему АПИ, которое работает нестабильно постоянно, то сыпать сообщениями уровня
  ERROR в данном случае мало эффективно.
  Таким образом сообщения этого уровня отлично подходят для решения задач:
    - определение внешних проблем;
    - мониторинг здоровья сервиса;
    - мониторинг связанности среды;
    - разбор ошибок при падении или отказе стартовать сервиса;
    - события для сервисов оповещения;





