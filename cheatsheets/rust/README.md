# Rust

[Назад к перечню шпаргалок][back]

**[Generics](generics.md)** - обобщенные типы.\
**[Closures](closures.md)** - замыкания - это анонимные функции.\
**[Lifetime](lifetime.md)** - время жизни ссылки.\
**[Test](test.md)** - функции, которые проверяют, что не тестовый код работает ожидаемым образом.\
**[Result](result.md)** - обработка потенциального сбоя с помощью типа `Result`.\
**[Option](option.md)** - .\
**[Box](box.md)** - .

| Keyword             | Описание                                                                                                                                     |
|---------------------|----------------------------------------------------------------------------------------------------------------------------------------------|
| as                  | выполнить примитивное преобразование, уточнить конкретную характеристику, которую содержит объект, или переименовать элемент в выражении use |
| async               | вернуть `Future` вместо блокирования текущего потока                                                                                         |
| await               | приостановить выполнение до тех пор, пока не будет готов результат `Future`                                                                  |
| break               | немедленно выйти из цикла                                                                                                                    |
| const               | определить константу или неизменяемый сырой указатель                                                                                        |
| continue            | досрочно перейти к следующей итерации цикла                                                                                                  |
| crate               | в пути модуля ссылается на корень пакета                                                                                                     |
| dyn                 | динамическая отсылка к объекту характеристики                                                                                                |
| else                | ветвь для конструкций потока управления `if` и `if let` в случае, если никакая другая ветвь не была исполнена                                |
| [enum](enum.md)     | определить перечисление                                                                                                                      |
| extern              | подключить внешнюю функцию или переменную                                                                                                    |
| false               | логический литерал «ложь»                                                                                                                    |
| [fn](fn.md)         | определить функцию или тип указателя на функцию                                                                                              |
| [for](for.md)       | перебор элементов итератора, реализация типажа или указание срока жизни более продолжительного периода                                       |
| [if](if.md)         | ветвление на основе результата условного выражения                                                                                           |
| [impl](impl.md)     | реализовать функциональность непосредственно или через типаж, методы                                                                         |
| in                  | часть синтаксиса определения цикла `for`                                                                                                     |
| let                 | объявить переменную                                                                                                                          |
| [loop](loop.md)     | безусловный (бесконечный) цикл                                                                                                               |
| [match](match.md)   | сопоставить значение с образцами                                                                                                             |
| mod                 | определить модуль                                                                                                                            |
| move                | заставить замыкание принять на себя владение всеми своими захватами                                                                          |
| mut                 | обозначить изменяемость для ссылок, сырых указателей или привязок к шаблонам                                                                 |
| pub                 | обозначить публичную доступность полей структур, блоков `impl` или модулей                                                                   |
| ref                 | привязка по ссылке                                                                                                                           |
| return              | возврат из функции                                                                                                                           |
| Self                | псевдоним для типа, который мы определяем или реализуем                                                                                      |
| self                | объект, содержащий этот метод, или текущий модуль                                                                                            |
| static              | глобальная переменная или время жизни на протяжении всего выполнения программы                                                               |
| [struct](struct.md) | определить структуру                                                                                                                         |
| super               | родительский модуль текущего модуля                                                                                                          |
| [trait](trait.md)   | определить типаж, интерфейс                                                                                                                  |
| true                | логический литерал «истина»                                                                                                                  |
| type                | определить псевдоним типа или ассоциированный тип                                                                                            |
| union               | определить union; является только ключевым словом при использовании в объявлении объединения                                                 |
| unsafe              | обозначить небезопасный код, функции, типажи или реализации                                                                                  |
| use                 | ввести объекты в область видимости                                                                                                           |
| where               | обозначить утверждения, которые ограничивают тип                                                                                             |
| [while](while.md)   | условный цикл, основанный на результате условного выражения                                                                                  |

### Ключевые слова, зарезервированные для будущего использования

- abstract
- become
- box
- do
- final
- macro
- override
- priv
- try
- typeof
- unsized
- virtual
- yield

## Macros

| Keyword                                 | Описание                                                                                       |
|-----------------------------------------|------------------------------------------------------------------------------------------------|
| concat_bytes `Experimental`             | Объединяет литералы в байтовый фрагмент.                                                       |
| concat_idents `Experimental`            | Объединяет идентификаторы в один идентификатор.                                                |
| const_format_args `Experimental`        | То же, что `format_args`, но может использоваться в некоторых контекстах const.                |
| format_args_nl `Experimental`           | То же, что `format_args`, но добавляет новую строку в конце.                                   |
| log_syntax `Experimental`               | Выводит переданные токены в стандартный вывод.                                                 |
| trace_macros `Experimental`             | Включает или отключает функциональность трассировки, используемую для отладки других макросов. |
| assert                                  | Утверждает, что логическое выражение находится `true` во время выполнения.                     |
| assert_eq                               | Утверждает, что два выражения равны друг другу (используя `PartialEq`).                        |
| assert_ne                               | Утверждает, что два выражения не равны друг другу (используя `PartialEq`).                     |
| cfg                                     | Вычисляет логические комбинации флагов конфигурации во время компиляции.                       |
| column                                  | Расширяется до номера столбца, в котором оно было вызвано.                                     |
| compile_error                           | Вызывает сбой компиляции с указанным сообщением об ошибке при обнаружении.                     |
| concat                                  | Объединяет литералы в статический фрагмент строки.                                             |
| dbg                                     | Выводит и возвращает значение заданного выражения для быстрой и грязной отладки.               |
| debug_assert                            | Утверждает, что логическое выражение находится `true` во время выполнения.                     |
| debug_assert_eq                         | Утверждает, что два выражения равны друг другу.                                                |
| debug_assert_ne                         | Утверждает, что два выражения не равны друг другу.                                             |
| env                                     | Проверяет переменную среды во время компиляции.                                                |
| eprint                                  | Выводит стандартную ошибку.                                                                    |
| eprintln                                | Выводит стандартную ошибку с новой строкой.                                                    |
| file                                    | Расширяется до имени файла, в котором оно было вызвано.                                        |
| format_args                             | Создает параметры для других макросов форматирования строк.                                    |
| include                                 | Анализирует файл как выражение или элемент в соответствии с контекстом.                        |
| include_bytes                           | Включает файл в качестве ссылки на массив байтов.                                              |
| include_str                             | Включает файл в кодировке UTF-8 в виде строки.                                                 |
| is_x86_feature_detected `x86 or x86-64` | Макрос для проверки во время выполнения, доступна ли функция ЦП на платформах x86/x86-64.      |
| line                                    | Расширяется до номера строки, в которой оно было вызвано.                                      |
| matches                                 | Возвращает, соответствует ли данное выражение какому-либо из заданных шаблонов.                |
| module_path                             | Расширяется до строки, представляющей текущий путь к модулю.                                   |
| option_env                              | Необязательно проверяет переменную среды во время компиляции.                                  |
| panic                                   | Вызывает панику в текущем потоке.                                                              |
| print                                   | Печатает на стандартный вывод.                                                                 |
| println                                 | Печатает на стандартный вывод с новой строкой.                                                 |
| stringify                               | Упорядочивает его аргументы.                                                                   |
| thread_local                            | Объявите новый ключ локального хранилища потока типа of `type std::thread::LocalKey`.          |
| todo                                    | Указывает на незаконченный код.                                                                |
| try `Deprecated`                        | Разворачивает результат или распространяет его ошибку.                                         |
| unimplemented                           | Указывает на невыполненный код, вызывая панику сообщением “не реализовано”.                    |
| unreachable                             | Указывает на недоступный код.                                                                  |
| vec                                     | Создает `Vec`, содержащий аргументы.                                                           |
| write                                   | Записывает форматированные данные в буфер.                                                     |
| writeln                                 | Записывает форматированные данные в буфер с добавлением новой строки.                          |

### Соглашения по именованию сущностей

| Item                    | Convention                                                 |
|-------------------------|------------------------------------------------------------|
| Crates                  | unclear                                                    |
| Modules                 | snake_case                                                 |
| Types                   | UpperCamelCase                                             |
| Traits                  | UpperCamelCase                                             |
| Enum variants           | UpperCamelCase                                             |
| Functions               | snake_case                                                 |
| Methods                 | snake_case                                                 |
| General constructors    | new or with_more_details                                   |
| Conversion constructors | from_some_other_type                                       |
| Macros                  | snake_case!                                                |
| Local variables         | snake_case                                                 |
| Statics                 | SCREAMING_SNAKE_CASE                                       |
| Constants               | SCREAMING_SNAKE_CASE                                       |
| Type parameters         | concise UpperCamelCase, usually single uppercase letter: T |
| Lifetimes               | short lowercase, usually a single letter: 'a, 'de, 'src    |
| Features                | unclear but see C-FEATURE                                  |

### as_, to_, into_

Преобразования должны предоставляться в виде методов со следующими префиксами имен:

| Префикс | Стоимость              | Владение                                                                                                                                     |
|---------|------------------------|----------------------------------------------------------------------------------------------------------------------------------------------|
| as_     | бесплатный, свободный  | заимствованный -> заимствованный (borrowed -> borrowed)                                                                                      |
| to_     | дорогой, ценный        | заимствованный -> заимствованный; заимствованный -> принадлежащий (типы, не являющиеся копиями); принадлежащий -> принадлежащий (типы копий) |
| into_   | изменяемый, переменная | принадлежащий -> принадлежащий (типы, не являющиеся копиями) (owned -> owned)                                                                |

Например:

- **str::as_bytes()** предоставляет `str` в виде фрагмента байтов UTF-8, который является бесплатным. Входные данные
  являются заимствованными &`str`, а выходные данные являются заимствованными `&[u8]`.
- **Path::to_str** выполняет дорогостоящую проверку UTF-8 на байты пути к операционной системе. Входные и выходные
  данные заимствованы. Было бы неправильно вызывать это `as_str` потому что этот метод имеет нетривиальные затраты во
  время выполнения.
- **str::to_lowercase()** выдает корректный в юникоде эквивалент в нижнем регистре `str`, который включает перебор
  символов строки и может потребовать выделения памяти. Входные данные являются заимствованными `&str`, а выходные -
  принадлежащими `String`.
- **f64::to_radians()** преобразует величину с плавающей запятой из градусов в радианы. Входные данные являются `f64`.
  Передача ссылки `&f64` не гарантируется, поскольку `f64` копирование обходится дешево. Вызов функции `into_radians`
  может ввести в заблуждение, поскольку входные данные не используются.
- **String::into_bytes()** извлекает базовую `Vec<u8>` часть `String`, которая является бесплатной. Он принимает права
  собственности на `String` и возвращает принадлежащий `Vec<u8>`.
- **BufReader::into_inner()** становится владельцем буферизованного считывателя и извлекает базовый считыватель, который
  является бесплатным. Данные в буфере удаляются.
- **BufWriter::into_inner()** получает право собственности на буферизованное средство записи и извлекает базовое
  средство записи, что требует потенциально дорогостоящей очистки любых буферизованных данных.

## Переменные

```rust
fn main() {
    let age = 36;
    age = 25;       // ошибка!
    println!("Age = {}", age);
}
```

```rust
fn main() {
    let mut age = 36;
    println!("Начальное значение: {}", age);

    age = 25;
    println!("Конечное значение: {}", age);
}
```

```rust
let (a, b) = (b, a);

// или

std::mem::swap(&mut a, &mut b);
```

### Затенение переменных (shadowing)

То есть мы можем определить переменную с одним, и тем же именем и она будет скрывать (затенять)
определение предыдущей переменной с тем же именем.

```rust
fn main() {
    let number = 10;
    println!("number = {}", number);

    let number = 15;
    println!("number = {}", number);

    let number = 254;
    println!("number = {}", number);
}
```

## Format

```rust
  let x = 42.1337;
  let s = format!("{:.2}", x);
  println!("{}", s); // 42.13
```

## Полиморфизм

- **Статический полиморфизм** требует, чтобы при компиляции программы было известно, какие конкретные типы используются в каждом обобщённом контексте. Имея эту информацию компилятор проводит, так называемую, мономорфизацию. Когда одна обобщённая сущность превращается в несколько сущностей с конкретными типами, используемыми в них. При этом размер исполняемого файла раздувается и мы теряем возможность подменять наследника в процессе выполнения программы. Взамен получаем более высокую скорость выполнения, так как компилятору известны конкретные типы и адреса функций для каждой ситуации, а следовательно, он может применять больше оптимизаций.

- **Динамический полиморфизм** работает посредством динамической диспетчеризации. При этом мы не знаем конкретного типа объекта и для получения адреса его методов в памяти используем дополнительную информацию — таблицу функций. Её содержимое зависит от того, какой конкретный тип скрывается за абстрактным указателем. Такой подход не раздувает исполняемый файл и позволяет подменять реализацию в процессе выполнения программы. Но при этом мы жертвуем частью производительности — для вызова метода нам придётся сначала прочитать его адрес из памяти, что значительно затрудняет оптимизацию программы на этапе компиляции.

Пример статического полиморфизма:

```rust
// Принимаем что угодно, реализующее трейт Shape.
fn areas_sum(shape1: impl Shape, shape2: impl Shape) -> f32 {
    shape1.area() + shape2.area()
}

fn foo(rectangle: Rectangle, circle: Circle) {
    // Можем передать две разные фигуры.
    let sum = areas_sum(rectangle, circle);
}
```

Пример динамического полиморфизма:

```rust
// Принимаем что угодно, реализующее трейт Shape.
// В этот раз принимаем не сами объекты, а ссылки на них,
// так как не зная конкретный тип объекта, мы не знаем и его размер,
// а следовательно, не сможем выделить для него место на стеке.
fn areas_sum(shape1: &dyn Shape, shape2: &dyn Shape) -> f32 {
    shape1.area() + shape2.area()
}

fn foo(rectangle: Rectangle, circle: Circle) {
    // Можем передать ссылки на две разные фигуры.
    let sum = areas_sum(&rectangle, &circle);
}
```

## Наследование

```rust
trait Shape {
    // У любой формы можно посчитать площадь.
    fn area(&self) -> f32;
}

trait HasAngles: Shape {
    // У любой фигуры с углами можно посчитать количество углов.
    fn angles_count(&self) -> i32;
}

struct Rectangle {
    x: f32,
    y: f32,
}

// Прямоугольник является формой.
impl Shape for Rectangle {
    fn area(&self) -> f32 {
        self.x * self.y
    }
}

// Прямоугольник является фигурой с углами.
impl HasAngles for Rectangle {
    fn angles_count(&self) -> i32 {
        4
    }
}

struct Circle {
    r: f32,
}

// Круг является формой
impl Shape for Circle {
    fn area(&self) -> f32 {
        self.r.powi(2) * PI
    }
}
```

## Macros

```rust
macro_rules! five_times {
    ($x:expr) => (5 * $x);
}

fn main() {
    assert_eq!(25, five_times!(2 + 3));
}
```

```rust

```

---

- [https://doc.rust-lang.org/book](https://doc.rust-lang.org/book/)
- [https://doc.rust-lang.org/stable/rust-by-example](https://doc.rust-lang.org/stable/rust-by-example/)
- [https://doc.rust-lang.org/reference](https://doc.rust-lang.org/reference/)
- [https://doc.rust-lang.org/rustdoc](https://doc.rust-lang.org/rustdoc/)
- [https://doc.rust-lang.org/std](https://doc.rust-lang.org/std/)
- [https://doc.rust-lang.org/cargo](https://doc.rust-lang.org/cargo/)
- [https://rust-lang.github.io/api-guidelines](https://rust-lang.github.io/api-guidelines/)
- [https://rust-cli.github.io/book/tutorial](https://rust-cli.github.io/book/tutorial/)

---

- [https://doc.rust-lang.ru/book](https://doc.rust-lang.ru/book/title-page.html)
- [https://metanit.com/rust](https://metanit.com/rust/)
- [https://refactoring.guru/ru/design-patterns/rust](https://refactoring.guru/ru/design-patterns/rust)

---

- [https://cheats.rs](https://cheats.rs/)
- [https://lib.rs](https://lib.rs/)
- [https://docs.rs](https://docs.rs/)
- [https://programming-idioms.org/cheatsheet/Rust](https://programming-idioms.org/cheatsheet/Rust)
- []()
- []()
- []()

---

- [https://github.com/rust-unofficial/awesome-rust](https://github.com/rust-unofficial/awesome-rust)
- [https://github.com/Eddort/learn-rust-ru](https://github.com/Eddort/learn-rust-ru)

[Назад к перечню шпаргалок][back]

[back]: <../.> "Назад к перечню шпаргалок"
